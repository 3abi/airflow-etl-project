<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Données Boursières</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
        }
        #results {
            margin-top: 20px;
        }
        .section {
            margin-bottom: 20px;
        }
        .section h3 {
            margin-bottom: 10px;
        }
        .section pre {
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            overflow-x: auto;
        }
        #loader {
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Récupérer les données boursières d'une action</h1>

    <div>
        <label for="symbol">Entrez le symbole de l'action (ex: AAPL, TSLA) :</label>
        <input type="text" id="symbol" placeholder="Ex : AAPL">
        <button onclick="fetchStockData()">Obtenir les données</button>
    </div>

    <div id="loader">
        <p>Chargement des données...</p>
    </div>

    <div id="results"></div>

    <script>
        // Remplacez ces valeurs par vos propres clés API
        const marketstackApiKey = '';
        const yahooFinanceApiKey = '';

        async function fetchStockData() {
            const symbol = document.getElementById('symbol').value.trim();

            if (!symbol) {
                alert('Veuillez entrer un symbole d\'action.');
                return;
            }

            // Afficher le loader
            document.getElementById('loader').style.display = 'block';
            document.getElementById('results').innerHTML = '';

            try {
                const stockData = await getStockData(symbol);

                // Masquer le loader
                document.getElementById('loader').style.display = 'none';

                // Afficher les résultats
                displayResults(stockData);
            } catch (error) {
                // Masquer le loader en cas d'erreur
                document.getElementById('loader').style.display = 'none';
                alert('Une erreur est survenue lors de la récupération des données.');
                console.error(error);
            }
        }

        async function getStockData(symbol) {
            try {
                const marketstackCurrentData = await getMarketstackCurrentData(symbol);
                const yahooFinanceCurrentData = await getYahooFinanceCurrentData(symbol);
                const marketstackHistoricalData = await getMarketstackHistoricalData(symbol);

                return {
                    marketstackCurrentData,
                    yahooFinanceCurrentData,
                    marketstackHistoricalData
                };
            } catch (error) {
                console.error("Erreur lors de la récupération des données boursières :", error);
                throw error;
            }
        }

        async function getMarketstackCurrentData(symbol) {
            const url = `https://api.marketstack.com/v1/eod/latest?access_key=${marketstackApiKey}&symbols=${symbol}`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Erreur lors de la récupération des données actuelles depuis Marketstack pour ${symbol}`);
            }

            const data = await response.json();
            return data.data[0];
        }

        async function getYahooFinanceCurrentData(symbol) {
            const url = `https://yfapi.net/v6/finance/quote?symbols=${symbol}`;

            const response = await fetch(url, {
                headers: {
                    'x-api-key': yahooFinanceApiKey
                }
            });

            if (!response.ok) {
                throw new Error(`Erreur lors de la récupération des données actuelles depuis Yahoo Finance pour ${symbol}`);
            }

            const data = await response.json();
            return data.quoteResponse.result[0];
        }

        async function getMarketstackHistoricalData(symbol) {
            const url = `https://api.marketstack.com/v1/eod?access_key=${marketstackApiKey}&symbols=${symbol}&limit=5`;

            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Erreur lors de la récupération des données historiques depuis Marketstack pour ${symbol}`);
            }

            const data = await response.json();
            return data.data;
        }

        function displayResults(data) {
            let html = '<div class="section"><h3>Données actuelles (Marketstack)</h3><pre>' + JSON.stringify(data.marketstackCurrentData, null, 2) + '</pre></div>';
            html += '<div class="section"><h3>Données actuelles (Yahoo Finance)</h3><pre>' + JSON.stringify(data.yahooFinanceCurrentData, null, 2) + '</pre></div>';
            html += '<div class="section"><h3>Données historiques (Marketstack)</h3><pre>' + JSON.stringify(data.marketstackHistoricalData, null, 2) + '</pre></div>';
            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>
