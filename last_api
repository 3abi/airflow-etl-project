<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Données Boursières - Fondamentaux</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        input, button {
            padding: 8px;
            margin-right: 10px;
        }
        #results {
            margin-top: 20px;
        }
        .section {
            margin-bottom: 20px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
            margin-bottom: 10px;
        }
        pre {
            background-color: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>

    <h1>Analyse Fondamentale d'une Action</h1>

    <div>
        <label for="symbol">Symbole de l'action :</label>
        <input type="text" id="symbol" placeholder="Ex : AAPL, MSFT">
        <button onclick="getFundamentals()">Obtenir les données</button>
    </div>

    <div id="results"></div>

    <script>
        const yahooFinanceApiKey = 'VOTRE_CLE_API_ICI';

        async function getFundamentals() {
            const symbol = document.getElementById('symbol').value.trim();
            if (!symbol) {
                alert('Veuillez entrer un symbole boursier.');
                return;
            }

            const url = `https://yfapi.net/v11/finance/quoteSummary/${symbol}?modules=price,summaryDetail,defaultKeyStatistics,financialData`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'x-api-key': yahooFinanceApiKey
                    }
                });

                if (!response.ok) {
                    throw new Error(`Erreur lors de la requête : ${response.statusText}`);
                }

                const data = await response.json();
                const quote = data.quoteSummary.result[0];

                const general = {
                    symbole: symbol,
                    nom: quote.price.longName,
                    exchange: quote.price.exchangeName
                };

                const fondamentaux = {
                    prixActuel: quote.price.regularMarketPrice?.raw,
                    devise: quote.price.currency,
                    capitalisation: quote.price.marketCap?.fmt,
                    tresorerieParAction: quote.financialData.totalCashPerShare?.fmt,
                    chiffreAffaires: quote.financialData.totalRevenue?.fmt,
                    valeurComptable: quote.defaultKeyStatistics.bookValue?.fmt
                };

                const ratios = {
                    PER: quote.summaryDetail.trailingPE?.fmt,
                    PCF: quote.defaultKeyStatistics.priceToCashFlow?.fmt,
                    PSR: quote.summaryDetail.priceToSalesTrailing12Months?.fmt,
                    PBR: quote.defaultKeyStatistics.priceToBook?.fmt
                };

                displayResults({ general, fondamentaux, ratios });

            } catch (error) {
                console.error("Erreur : ", error);
                alert("Impossible de récupérer les données.");
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            const genSection = createSection("Données Générales", data.general);
            const fundSection = createSection("Données Fondamentales Actuelles", data.fondamentaux);
            const ratiosSection = createSection("Ratios Financiers", data.ratios);

            resultsDiv.appendChild(genSection);
            resultsDiv.appendChild(fundSection);
            resultsDiv.appendChild(ratiosSection);
        }

        function createSection(title, obj) {
            const div = document.createElement('div');
            div.className = 'section';
            const h2 = document.createElement('h2');
            h2.textContent = title;
            const pre = document.createElement('pre');
            pre.textContent = JSON.stringify(obj, null, 2);
            div.appendChild(h2);
            div.appendChild(pre);
            return div;
        }
    </script>

</body>
</html>
