import os
from xmldiff import main, formatting

# === R√©pertoires source ===
dir1 = "C:/chemin/vers/rep1"
dir2 = "C:/chemin/vers/rep2"

# === Formatter en texte clair, verbeux ===
formatter = formatting.DiffFormatter(normalize=formatting.WS_BOTH)

# === Lister les fichiers communs (par nom) ===
fichiers1 = set(f for f in os.listdir(dir1) if f.endswith(".xml"))
fichiers2 = set(f for f in os.listdir(dir2) if f.endswith(".xml"))
fichiers_communs = sorted(fichiers1 & fichiers2)

if not fichiers_communs:
    print("‚ùó Aucun fichier XML commun trouv√© entre les deux r√©pertoires.")
    exit()

# === Comparaison fichier par fichier ===
for fichier in fichiers_communs:
    path1 = os.path.join(dir1, fichier)
    path2 = os.path.join(dir2, fichier)

    print(f"\nüîç Comparaison de : {fichier}")
    try:
        diff = main.diff_files(
            path1, path2,
            formatter=formatter,
            fast_match=False,
            uniqueattrs=["id"],
            ratio_mode=True
        )

        if diff:
            print("‚ùó Diff√©rences d√©tect√©es :")
            for line in diff:
                print("  ‚Ä¢", line)
        else:
            print("‚úÖ Aucun changement d√©tect√©.")

    except Exception as e:
        print(f"‚ùå Erreur lors de la comparaison de {fichier} : {e}")
