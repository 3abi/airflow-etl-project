#!/bin/bash

# Récupère l'ID de la réponse passée depuis MariaDB
RESPONSE_ID="$1"
LOGFILE="/tmp/limesurvey_pipeline.log"

echo "[INFO] Nouvelle réponse ID=$RESPONSE_ID à $(date)" >> "$LOGFILE"

# Appel du script Python 1 - Initialisation des variables
/usr/bin/python3 /opt/limesurvey_processing/init_variables.py "$RESPONSE_ID" >> "$LOGFILE" 2>&1

# Appel du script Python 2 - Traitements principaux
/usr/bin/python3 /opt/limesurvey_processing/process_response.py "$RESPONSE_ID" >> "$LOGFILE" 2>&1

echo "[INFO] Fin traitement ID=$RESPONSE_ID à $(date)" >> "$LOGFILE"
